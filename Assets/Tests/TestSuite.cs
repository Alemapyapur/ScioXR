using System.Collections;
using System.Collections.Generic;
using System.IO;
using NUnit.Framework;
using UnityEngine;
using UnityEngine.SceneManagement;
using UnityEngine.TestTools;

namespace Tests
{
    public class TestSuite
    {
        /*[UnityTest]
        public IEnumerator ConversionIntBoolArray()
        {
            bool[] testArray = { true, false, false, true, false };
            int converted = Util.BoolArrayToInt(testArray);
            bool[] finalArray = Util.IntToBoolArray(converted, testArray.Length);

            Assert.AreEqual(testArray, finalArray);

            return null;
        }*/

        private static string jsonScene = @"{""environment"":"""",""saveData"":[{""id"":9,""parent"":0,""name"":""Plate"",""model"":""Plate"",""texture"":""marble_01"",""color"":""FFFFFDFF"",""position"":{""x"":0.9507091641426086,""y"":0.8754031658172607,""z"":1.6107635498046875},""rotation"":{""x"":0.02444225363433361,""y"":0.16621994972229004,""z"":-0.013855468481779099,""w"":0.9856884479522705},""scale"":{""x"":0.05267365276813507,""y"":0.03610977903008461,""z"":0.03610977903008461},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":10,""parent"":0,""name"":""Plate"",""model"":""Plate"",""texture"":""marble_02"",""color"":""FFFFFF"",""position"":{""x"":0.3216511011123657,""y"":0.8629510402679443,""z"":1.7758440971374512},""rotation"":{""x"":0.0033311813604086637,""y"":-0.5696257948875427,""z"":-0.006555702071636915,""w"":0.8218713402748108},""scale"":{""x"":0.0328846201300621,""y"":0.04921933263540268,""z"":0.05799652636051178},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":15,""parent"":0,""name"":""Triangle"",""model"":""Triangle"",""texture"":""tiles_02"",""color"":""FFE400FF"",""position"":{""x"":0.21211868524551392,""y"":0.8829270005226135,""z"":1.8020204305648804},""rotation"":{""x"":-0.03753991797566414,""y"":0.6685855388641357,""z"":0.013544832356274128,""w"":-0.7425636649131775},""scale"":{""x"":0.0009999999310821295,""y"":0.0009999999310821295,""z"":0.0009999999310821295},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":16,""parent"":0,""name"":""Plate"",""model"":""Plate"",""texture"":""tiles_02"",""color"":""FFF3F3FF"",""position"":{""x"":-0.29458820819854736,""y"":0.8643428683280945,""z"":1.9410245418548584},""rotation"":{""x"":-0.02218695729970932,""y"":0.10207946598529816,""z"":0.026977024972438812,""w"":0.9941628575325012},""scale"":{""x"":0.042359914630651474,""y"":0.10699083656072617,""z"":0.02997143566608429},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":18,""parent"":0,""name"":""Banana_pill"",""model"":""Banana_pill"",""texture"":"""",""color"":""FFE600FF"",""position"":{""x"":-0.3275540769100189,""y"":0.9513686299324036,""z"":1.9952579736709595},""rotation"":{""x"":-0.4614984095096588,""y"":0.5159963369369507,""z"":0.4763113856315613,""w"":0.5421204566955566},""scale"":{""x"":0.03178251162171364,""y"":0.03178251162171364,""z"":0.03178251162171364},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":19,""parent"":0,""name"":""Banana"",""model"":""Banana"",""texture"":"""",""color"":""EAFF00FF"",""position"":{""x"":-0.32282885909080505,""y"":0.9722450375556946,""z"":1.9150383472442627},""rotation"":{""x"":0.011211585253477097,""y"":-0.7015367746353149,""z"":0.04493645206093788,""w"":0.7111266851425171},""scale"":{""x"":0.03754916042089462,""y"":0.034757036715745926,""z"":0.03754916042089462},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":7,""parent"":0,""name"":""Stand"",""model"":""Stand"",""texture"":"""",""color"":""FFFFFF"",""position"":{""x"":0.5786664485931396,""y"":-0.0007871687412261963,""z"":2.140251636505127},""rotation"":{""x"":-0.0013787312200292945,""y"":0.14196588099002838,""z"":-0.0020633365493267775,""w"":0.9898684620857239},""scale"":{""x"":0.10493365675210953,""y"":0.03530970588326454,""z"":0.04485420137643814},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[{""blockType"":""StartEvent"",""editorPosition"":{""x"":-212.40200805664062,""y"":196.26898193359375},""paramInt"":0,""paramString"":"""",""objectReference"":0,""blocks"":[{""blockType"":""ShowLook"",""editorPosition"":{""x"":0,""y"":0},""paramInt"":0,""paramString"":"""",""objectReference"":0,""blocks"":[]}]}]}},{""id"":2,""parent"":0,""name"":""Cube"",""model"":""Box"",""texture"":""textile_01"",""color"":""FFFFFF"",""position"":{""x"":1.6610822677612305,""y"":0.8724631667137146,""z"":0.29539984464645386},""rotation"":{""x"":-0.539347231388092,""y"":-0.43004536628723145,""z"":-0.42609331011772156,""w"":0.5853290557861328},""scale"":{""x"":0.09819819778203964,""y"":0.03857402503490448,""z"":0.010009923949837685},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":3,""parent"":0,""name"":""Cube"",""model"":""Box"",""texture"":""textile_01"",""color"":""FFFFFF"",""position"":{""x"":1.722938895225525,""y"":0.8756575584411621,""z"":-0.14084449410438538},""rotation"":{""x"":-0.5596387386322021,""y"":-0.4322177469730377,""z"":-0.4287594258785248,""w"":0.5622790455818176},""scale"":{""x"":0.5202077031135559,""y"":0.04649493470788002,""z"":0.009192513301968575},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":5,""parent"":0,""name"":""Cylinder"",""model"":""Cilinder"",""texture"":"""",""color"":""091798FF"",""position"":{""x"":-1.475953459739685,""y"":0.6393968462944031,""z"":1.282645583152771},""rotation"":{""x"":-0.007796456106007099,""y"":0.11983022093772888,""z"":0.026310939341783524,""w"":0.9924150705337524},""scale"":{""x"":0.03805795684456825,""y"":0.6376686692237854,""z"":0.03805795684456825},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":1,""parent"":5,""name"":""Cube"",""model"":""Box"",""texture"":""wall_04"",""color"":""FFFEFEFF"",""position"":{""x"":-1.4412119388580322,""y"":1.2510769367218018,""z"":1.3213562965393066},""rotation"":{""x"":-0.06459812074899673,""y"":-0.7027919888496399,""z"":-0.695894718170166,""w"":0.13282008469104767},""scale"":{""x"":0.3125687539577484,""y"":19.223709106445312,""z"":0.7492404580116272},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":1,""parent"":0,""name"":""Cube"",""model"":""Box"",""texture"":""wood_white"",""color"":""FFFFFF"",""position"":{""x"":1.918060541152954,""y"":0.41328078508377075,""z"":0.6075196266174316},""rotation"":{""x"":0.02833094447851181,""y"":-0.6151087880134583,""z"":0.019094860181212425,""w"":0.7877017855644226},""scale"":{""x"":0.025917984545230865,""y"":0.41137802600860596,""z"":0.0789908692240715},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":2,""parent"":0,""name"":""Cube"",""model"":""Box"",""texture"":""wood_white"",""color"":""FFFFFF"",""position"":{""x"":1.505534291267395,""y"":0.4401441812515259,""z"":-0.8611299991607666},""rotation"":{""x"":-0.009278940036892891,""y"":-0.12716121971607208,""z"":-0.03318219259381294,""w"":-0.9912834763526917},""scale"":{""x"":0.09196656197309494,""y"":0.39387375116348267,""z"":0.03264658525586128},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":6,""parent"":0,""name"":""Cube"",""model"":""Box"",""texture"":""tiles_02"",""color"":""FFFFFF"",""position"":{""x"":1.732779622077942,""y"":0.8265252113342285,""z"":-0.13717642426490784},""rotation"":{""x"":0.010773404501378536,""y"":0.1373453289270401,""z"":0.005366884637624025,""w"":0.9904501438140869},""scale"":{""x"":0.3901248276233673,""y"":0.028455466032028198,""z"":0.7882717847824097},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":1,""parent"":0,""name"":""Apple"",""model"":""Apple"",""texture"":""textile_01"",""color"":""FFFFFF"",""position"":{""x"":-0.3006021976470947,""y"":0.9779179096221924,""z"":1.8103914260864258},""rotation"":{""x"":0.056144677102565765,""y"":-0.1297179013490677,""z"":-0.07492660731077194,""w"":0.9871205687522888},""scale"":{""x"":0.02626265026628971,""y"":0.02626265026628971,""z"":0.02626265026628971},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":3,""parent"":0,""name"":""Box_blue"",""model"":""Box_yellow"",""texture"":"""",""color"":""F3FF00FF"",""position"":{""x"":-0.1006530225276947,""y"":0.8774397373199463,""z"":2.50211763381958},""rotation"":{""x"":0.008260254748165607,""y"":-0.6118207573890686,""z"":-0.0072739277966320515,""w"":0.7909198999404907},""scale"":{""x"":0.021648820489645004,""y"":0.02165343053638935,""z"":0.021648820489645004},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":1,""parent"":0,""name"":""Box_blue"",""model"":""Box_blue"",""texture"":"""",""color"":""00AFFFFF"",""position"":{""x"":0.5128641724586487,""y"":0.8766258358955383,""z"":2.3512845039367676},""rotation"":{""x"":0.004331698175519705,""y"":-0.6176424622535706,""z"":-0.00881058070808649,""w"":0.7863977551460266},""scale"":{""x"":0.022393491119146347,""y"":0.018134092912077904,""z"":0.022424079477787018},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":2,""parent"":0,""name"":""Box_red"",""model"":""Box_red"",""texture"":"""",""color"":""EE0000FF"",""position"":{""x"":1.246321678161621,""y"":0.8697901964187622,""z"":2.1288585662841797},""rotation"":{""x"":-0.009305654093623161,""y"":-0.5869897603988647,""z"":-0.002645318629220128,""w"":0.8095366358757019},""scale"":{""x"":0.018056074157357216,""y"":0.014736533164978027,""z"":0.025326216593384743},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":3,""parent"":0,""name"":""Chicken_meat"",""model"":""Chicken_meat"",""texture"":"""",""color"":""6C3A00FF"",""position"":{""x"":0.8217520117759705,""y"":0.9442562460899353,""z"":1.6818065643310547},""rotation"":{""x"":0.028398755937814713,""y"":-0.013208531774580479,""z"":0.036139488220214844,""w"":0.9988558888435364},""scale"":{""x"":0.030375873669981956,""y"":0.030375873669981956,""z"":0.030375873669981956},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":4,""parent"":0,""name"":""Fish"",""model"":""Fish"",""texture"":"""",""color"":""CC6E00FF"",""position"":{""x"":0.9613312482833862,""y"":0.9162052273750305,""z"":1.5682334899902344},""rotation"":{""x"":-0.14243881404399872,""y"":0.2092008888721466,""z"":0.014790571294724941,""w"":0.9673300385475159},""scale"":{""x"":0.014886901713907719,""y"":0.012162280268967152,""z"":0.014886901713907719},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":5,""parent"":0,""name"":""Chicken_meat"",""model"":""Chicken_meat"",""texture"":"""",""color"":""D87706FF"",""position"":{""x"":1.0563533306121826,""y"":0.9419412016868591,""z"":1.6389824151992798},""rotation"":{""x"":-0.24952971935272217,""y"":-0.6105957627296448,""z"":-0.7121024131774902,""w"":0.2404535561800003},""scale"":{""x"":0.030591128394007683,""y"":0.030591128394007683,""z"":0.030591128394007683},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[{""blockType"":""StartEvent"",""editorPosition"":{""x"":-243.97071838378906,""y"":160.85855102539062},""paramInt"":0,""paramString"":"""",""objectReference"":0,""blocks"":[{""blockType"":""ShowLook"",""editorPosition"":{""x"":0,""y"":0},""paramInt"":0,""paramString"":"""",""objectReference"":0,""blocks"":[]},{""blockType"":""MoveMotion"",""editorPosition"":{""x"":0,""y"":0},""paramInt"":1,""paramString"":"""",""objectReference"":8,""blocks"":[]},{""blockType"":""PointsTowardMotion"",""editorPosition"":{""x"":0,""y"":0},""paramInt"":1,""paramString"":"""",""objectReference"":8,""blocks"":[]},{""blockType"":""WaitControl"",""editorPosition"":{""x"":0,""y"":0},""paramInt"":1,""paramString"":"""",""objectReference"":0,""blocks"":[]},{""blockType"":""BroadcastEvent"",""editorPosition"":{""x"":0,""y"":0},""paramInt"":0,""paramString"":""test"",""objectReference"":0,""blocks"":[]}]},{""blockType"":""ReceiveEvent"",""editorPosition"":{""x"":23.025360107421875,""y"":158.5536346435547},""paramInt"":0,""paramString"":""test"",""objectReference"":0,""blocks"":[{""blockType"":""HideLook"",""editorPosition"":{""x"":0,""y"":0},""paramInt"":0,""paramString"":"""",""objectReference"":0,""blocks"":[]},{""blockType"":""DestroyControl"",""editorPosition"":{""x"":0,""y"":0},""paramInt"":0,""paramString"":"""",""objectReference"":0,""blocks"":[]}]}]}},{""id"":6,""parent"":0,""name"":""Milk_cart"",""model"":""Milk_cart"",""texture"":""wall_04"",""color"":""FFFFFFFF"",""position"":{""x"":0.4719296097755432,""y"":0.9015804529190063,""z"":1.7959798574447632},""rotation"":{""x"":0.077435202896595,""y"":0.12446704506874084,""z"":0.0039857798255980015,""w"":0.9891895055770874},""scale"":{""x"":0.009417548775672913,""y"":0.009417548775672913,""z"":0.007467465475201607},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":7,""parent"":0,""name"":""Yogurt cup"",""model"":""Yogurt_cup"",""texture"":""wall_04"",""color"":""FFFFFF"",""position"":{""x"":0.37835443019866943,""y"":0.8907849788665771,""z"":1.7299760580062866},""rotation"":{""x"":0.012383056804537773,""y"":-0.16790790855884552,""z"":-0.0021844888105988503,""w"":0.9857224822044373},""scale"":{""x"":0.030957801267504692,""y"":0.030957801267504692,""z"":0.030957801267504692},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}},{""id"":8,""parent"":0,""name"":""Apple"",""model"":""Apple"",""texture"":""textile_01"",""color"":""FFFFFF"",""position"":{""x"":-0.21702107787132263,""y"":0.9937160611152649,""z"":1.9917008876800537},""rotation"":{""x"":-0.1770499348640442,""y"":-0.41105934977531433,""z"":0.1493024230003357,""w"":0.8816986083984375},""scale"":{""x"":0.019531534984707832,""y"":0.019531534984707832,""z"":0.019531534984707832},""isVisible"":1,""isInteractable"":false,""physics"":{""mass"":1,""drag"":0,""angularDrag"":0.05000000074505806},""text"":{""text"":"""",""size"":20,""color"":"""",""horizontalAligment"":0,""verticalAligment"":0},""code"":{""blocks"":[]}}],""globalData"":{""variables"":[""test""],""messages"":[""test""]}}";

        [UnityTest]
        public IEnumerator SaveLoadScene()
        {
            SceneManager.LoadScene("Main");

            yield return new WaitForSeconds(1.0f);

            AppManager.instance.currentSceneName = "unitTestScene";

            using (var writer = new StreamWriter(File.Open(AppManager.instance.GetScenePath(), FileMode.Create)))
            {
                writer.Write(jsonScene);
            }

            yield return new WaitForSeconds(1.0f);

            SceneManager.LoadScene("Editor");

            yield return new WaitForSeconds(1.0f);

            ScioXRSceneManager.instance.SaveScene(AppManager.instance.GetScenePath());

            yield return new WaitForSeconds(1.0f);

            SceneManager.LoadScene("Player");

            yield return new WaitForSeconds(4.0f);

            yield return null;
        }

        [UnityTest]
        public IEnumerator CodeLogicTest()
        {
            //TEST CASE
            StartEvent startEvent = new StartEvent();
            MoveMotion moveMotion = new MoveMotion();
            //moveMotion.moveStep = new IntVariable(1);
            startEvent.AddBlock(moveMotion);

            KeyPressedEvent keyPressedEvent = new KeyPressedEvent();
            keyPressedEvent.key = KeyCode.Space;
            MoveMotion moveMotion2 = new MoveMotion();
            //moveMotion2.moveStep = new IntVariable(1);
            keyPressedEvent.AddBlock(moveMotion2);

            yield return null;
        }

        [UnityTest]
        public IEnumerator RectExtensionTest()
        {
            SceneManager.LoadScene("Main");

            yield return new WaitForSeconds(1.0f);

            RectTransform t1 = GameObject.Find("K6").GetComponent<RectTransform>();
            RectTransform t2 = GameObject.Find("K7").GetComponent<RectTransform>();

            t1.Overlaps(t2);
            t1.Overlaps(t2, true);
            t1.WorldRect();
            yield return null;
        }
    }
}
